@page "/accounts/delete/{id:int}"
@inject HttpClient Http
@inject NavigationManager NavigationManager

<h1>Delete Account</h1>
<h3>Are you sure you want to delete this?</h3>
<hr />

@if (accountModel == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div>
        <dl>
            <dt>Account Id</dt>
            <dd>@accountModel.Id</dd>
            <dt>First Name</dt>
            <dd> @accountModel.FirstName</dd>
            <dt>Last Name</dt>
            <dd> @accountModel.LastName</dd>
        </dl>
    </div>

    <EditForm Model="@accountModel" OnValidSubmit="@HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />
        <button type="submit">Delete</button>
    </EditForm>

    <p>
        <NavLink href="/accounts">Back to Accounts</NavLink>
    </p>
}

@code {
    [Parameter]
    public int Id { get; set; }

    private AccountViewModel accountModel = new();

    protected override async Task OnInitializedAsync()
    {
        AccountDto accountDto = await Http.GetFromJsonAsync<AccountDto>("http://localhost:41943/api/accounts/" + Id);
        accountModel = new Mapper(ViewModelMapperConfig.Config).Map<AccountViewModel>(accountDto);
    }

    private async Task HandleValidSubmit()
    {
        AccountDto accountDto = new Mapper(ViewModelMapperConfig.Config).Map<AccountDto>(accountModel);
        var response = await Http.DeleteAsync("http://localhost:41943/api/accounts/" + accountDto.Id);

        NavigationManager.NavigateTo("/accounts");
    }
}
